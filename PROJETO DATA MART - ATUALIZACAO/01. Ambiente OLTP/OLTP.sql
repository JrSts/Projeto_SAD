USE PROJETO_SAD

-- OLTP

CREATE SCHEMA OLTP

CREATE TABLE OLTP.TB_CLIENTE (
	COD_CLIENTE INT NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	APELIDO VARCHAR(100) NOT NULL,
	DATA_NASCIMENTO DATETIME NULL,
	TELEFONE VARCHAR(11) NULL,
	ENDERECO VARCHAR(200) NULL,
	CPF VARCHAR(11) NOT NULL,
	SENHA VARCHAR(10) NOT NULL
)

INSERT INTO OLTP.TB_CLIENTE VALUES (1, 'JOSE', 'ZÉ', '19841207', '99998888', 'RUA A', '78987456545', '1234'),
								   (2, 'JOSEANE', 'JOSE', '19901017', '99997777', 'RUA B', '78980258256', '4321'),
								   (3, 'JOSEFA', 'JO', '19770109', '99887766', NULL, '78946845123', '2468')

CREATE TABLE OLTP.TB_FUNCIONARIO (
	COD_FUNCIONARIO INT NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	DATA_NASCIMENTO DATETIME NOT NULL,
	TELEFONE VARCHAR(10) NOT NULL,
	ENDERECO VARCHAR(200) NOT NULL,
	SALARIO NUMERIC(10,2) NOT NULL,
	CPF VARCHAR(11) NOT NULL,
	SENHA VARCHAR(10) NOT NULL
)

INSERT INTO OLTP.TB_FUNCIONARIO VALUES (10, 'JOAO', '19900201', '97987987', 'RUA C', 1000, '987963321', '3692'),
									   (20, 'JOANA', '19941213', '97987579', 'RUA C', 1500, '987926821', '4561')


CREATE TABLE OLTP.TB_CATEGORIA (
	COD_CATEGORIA INT NOT NULL,
	CATEGORIA VARCHAR(100) NOT NULL
)

INSERT INTO OLTP.TB_CATEGORIA VALUES (100, 'ALIMENTOS'),
									 (200, 'PRODUTOS DE LIMPEZA'),
									 (300, 'HIGIENE PESSOAL'),
									 (400, 'DOCES'),
									 (500, 'FRIOS'),
									 (600, 'BEBIDAS')
	
CREATE TABLE OLTP.TB_DIVIDA (
	COD_DIVIDA INT NOT NULL,
	COD_CLIENTE INT NOT NULL,
	COD_FUNCIONARIO INT NOT NULL,
	COD_CATEGORIA INT NOT NULL,
	DATA DATETIME NOT NULL,
	VALOR NUMERIC(10,2) NOT NULL,
	STATUS_DIVIDA VARCHAR(20) NOT NULL CHECK (STATUS_DIVIDA = 'PAGO' OR STATUS_DIVIDA ='PENDENTE')
)

INSERT INTO OLTP.TB_DIVIDA VALUES (1000, 1, 10, 100, '20180808',50,'PENDENTE'),
                                  (1001, 1, 20, 300, '20180808',120,'PENDENTE'),
								  (1002, 3, 10, 600, '20180808',200,'PENDENTE'),
								  (1003, 2, 20, 300, '20180808',30,'PENDENTE')

CREATE TABLE OLTP.TB_PAGAMENTO (
	COD_PAGAMENTO INT NOT NULL,
	COD_CLIENTE INT NOT NULL,
	COD_FUNCIONARIO INT NOT NULL,
	DATA DATETIME NOT NULL,
	VALOR NUMERIC(10,2) NOT NULL
)


ALTER TABLE OLTP.TB_CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY (COD_CLIENTE)
ALTER TABLE OLTP.TB_FUNCIONARIO ADD CONSTRAINT PK_FUNCIONARIO PRIMARY KEY (COD_FUNCIONARIO)
ALTER TABLE OLTP.TB_DIVIDA ADD CONSTRAINT PK_DIVIDA PRIMARY KEY (COD_DIVIDA)
ALTER TABLE OLTP.TB_CATEGORIA ADD CONSTRAINT PK_CATEGORIA PRIMARY KEY (COD_CATEGORIA)
ALTER TABLE OLTP.TB_PAGAMENTO ADD CONSTRAINT PK_PAGAMENTO PRIMARY KEY (COD_PAGAMENTO)

ALTER TABLE OLTP.TB_DIVIDA ADD CONSTRAINT FK_DIVIDA_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES OLTP.TB_CLIENTE (COD_CLIENTE)
ALTER TABLE OLTP.TB_DIVIDA ADD CONSTRAINT FK_DIVIDA_FUNCIONARIO FOREIGN KEY (COD_FUNCIONARIO) REFERENCES OLTP.TB_FUNCIONARIO (COD_FUNCIONARIO)
ALTER TABLE OLTP.TB_DIVIDA ADD CONSTRAINT FK_DIVIDA_CATEGORIA FOREIGN KEY (COD_CATEGORIA) REFERENCES OLTP.TB_CATEGORIA (COD_CATEGORIA)
ALTER TABLE OLTP.TB_PAGAMENTO ADD CONSTRAINT FK_PAGAMENTO_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES OLTP.TB_CLIENTE (COD_CLIENTE)
ALTER TABLE OLTP.TB_PAGAMENTO ADD CONSTRAINT FK_PAGAMENTO_FUNCIONARIO FOREIGN KEY (COD_FUNCIONARIO) REFERENCES OLTP.TB_FUNCIONARIO (COD_FUNCIONARIO)


INSERT INTO OLTP.TB_PAGAMENTO VALUES (2000, 1, 10, '20180908', 150),
									 (2001, 2, 10, '20180912', 150),
									 (2002, 3, 20, '20180820', 30)